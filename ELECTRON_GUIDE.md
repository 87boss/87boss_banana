# PenguinMagic Electron æ‰“åŒ…ä½¿ç”¨èªªæ˜

## å·²å®Œæˆçš„å·¥ä½œ

âœ… å®‰è£ Electron ç›¸é—œä¾è³´
âœ… å»ºç«‹ Electron ä¸»ç¨‹å¼ï¼ˆelectron/main.cjsï¼‰
âœ… å»ºç«‹é è¼‰å…¥æŒ‡ä»¤ç¢¼ï¼ˆelectron/preload.cjsï¼‰
âœ… é…ç½®å¾Œç«¯æ”¯æ´ Electron ç’°å¢ƒ
âœ… é…ç½® Vite æ§‹å»º
âœ… æ›´æ–° package.json æŒ‡ä»¤ç¢¼å’Œé…ç½®
âœ… å»ºç«‹æ‡‰ç”¨åœ–ç¤º
âœ… æ¸¬è©¦é–‹ç™¼æ¨¡å¼ - æˆåŠŸåŸ·è¡Œ
âœ… å‰ç«¯æ§‹å»º - æˆåŠŸ

## é–‹ç™¼æ¨¡å¼

å•Ÿå‹•é–‹ç™¼æ¨¡å¼ï¼ˆåŒ…å«ç†±éè¼‰ï¼‰ï¼š

```bash
npm run electron:dev
```

é€™å°‡åŒæ™‚å•Ÿå‹•ï¼š
1. å¾Œç«¯æœå‹™ï¼ˆåŸ  8765ï¼‰
2. Vite é–‹ç™¼ä¼ºæœå™¨ï¼ˆåŸ  5176ï¼‰
3. Electron è¦–çª—

## ç”Ÿç”¢æ§‹å»º

### åƒ…æ§‹å»ºå‰ç«¯
```bash
npm run build
```

### æ‰“åŒ… Windows æ‡‰ç”¨
```bash
npm run package
```

é€™å°‡ï¼š
1. æ§‹å»ºå‰ç«¯ï¼ˆç”Ÿæˆ dist/ï¼‰
2. ä½¿ç”¨ electron-builder æ‰“åŒ…
3. è¼¸å‡ºåˆ° release/ ç›®éŒ„

### æ‰“åŒ…æ‰€æœ‰å¹³è‡º
```bash
npm run package:all
```

æ”¯æ´çš„æ‰“åŒ…æ ¼å¼ï¼š
- **Windows**: NSIS å®‰è£åŒ…ã€ä¾¿æ”œç‰ˆ
- **macOS**: DMGã€ZIP
- **Linux**: AppImageã€DEB

## å°ˆæ¡ˆçµæ§‹

```
PenguinMagic/
â”œâ”€â”€ electron/
â”‚   â”œâ”€â”€ main.cjs          # Electron ä¸»ç¨‹å¼
â”‚   â””â”€â”€ preload.cjs       # é è¼‰å…¥æŒ‡ä»¤ç¢¼
â”œâ”€â”€ backend-nodejs/       # å¾Œç«¯æœå‹™
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ server.js     # Express ä¼ºæœå™¨
â”‚   â”‚   â”œâ”€â”€ config.js     # é…ç½®ï¼ˆæ”¯æ´ Electron ç’°å¢ƒï¼‰
â”‚   â”‚   â””â”€â”€ routes/       # API è·¯ç”±
â”‚   â””â”€â”€ node_modules/     # å¾Œç«¯ä¾è³´ï¼ˆæœƒæ‰“åŒ…é€²æ‡‰ç”¨ï¼‰
â”œâ”€â”€ resources/            # æ‡‰ç”¨è³‡æº
â”‚   â”œâ”€â”€ icon.svg          # SVG åœ–ç¤º
â”‚   â”œâ”€â”€ icon.png          # PNG åœ–ç¤º
â”‚   â””â”€â”€ README.md         # åœ–ç¤ºç”Ÿæˆèªªæ˜
â”œâ”€â”€ dist/                 # å‰ç«¯æ§‹å»ºç”¢ç‰©
â”œâ”€â”€ release/              # æ‰“åŒ…è¼¸å‡ºç›®éŒ„
â””â”€â”€ package.json          # å°ˆæ¡ˆé…ç½®
```

## ç’°å¢ƒè®Šæ•¸

### é–‹ç™¼ç’°å¢ƒ
- `NODE_ENV=development`
- ä½¿ç”¨å°ˆæ¡ˆæ ¹ç›®éŒ„ä½œç‚ºè³‡æ–™ç›®éŒ„

### ç”Ÿç”¢ç’°å¢ƒï¼ˆElectronï¼‰
- `NODE_ENV=production`
- `IS_ELECTRON=true`
- `USER_DATA_PATH`: ä½¿ç”¨è€…è³‡æ–™ç›®éŒ„ï¼ˆç”± Electron æä¾›ï¼‰
- è³‡æ–™å„²å­˜åœ¨ï¼š`%APPDATA%/penguin-magic` (Windows)

## è·¯å¾‘è™•ç†

### é–‹ç™¼æ¨¡å¼
- åŸºç¤ç›®éŒ„ï¼šå°ˆæ¡ˆæ ¹ç›®éŒ„
- å‰ç«¯ï¼šhttp://localhost:5176
- å¾Œç«¯ï¼šhttp://localhost:8765

### ç”Ÿç”¢æ¨¡å¼ï¼ˆElectronï¼‰
- åŸºç¤ç›®éŒ„ï¼šä½¿ç”¨è€…è³‡æ–™ç›®éŒ„
- å‰ç«¯ï¼šå¾ dist/ è¼‰å…¥ï¼ˆç”±å¾Œç«¯æœå‹™ï¼‰
- å¾Œç«¯ï¼šå…§åµŒåœ¨æ‡‰ç”¨ä¸­ï¼Œè‡ªå‹•å•Ÿå‹•

## åŠŸèƒ½ç‰¹æ€§

### å·²å¯¦ç¾
- âœ… è¦–çª—ç®¡ç†ï¼ˆå»ºç«‹ã€é—œé–‰ã€ç”Ÿå‘½é€±æœŸï¼‰
- âœ… å¾Œç«¯æœå‹™è‡ªå‹•å•Ÿå‹•å’Œåœæ­¢
- âœ… åŸç”Ÿé¸å–®æ¬„ï¼ˆæª”æ¡ˆã€ç·¨è¼¯ã€æª¢è¦–ã€å¹«åŠ©ï¼‰
- âœ… é–‹ç™¼è€…å·¥å…·ï¼ˆF12ï¼‰
- âœ… ä¸Šä¸‹æ–‡éš”é›¢å’Œå®‰å…¨é…ç½®
- âœ… è·¨å¹³è‡ºè·¯å¾‘è™•ç†
- âœ… åœ–ç¤ºè³‡æºç®¡ç†

### å¯æ“´å……å¥—ä»¶åŠŸèƒ½
- ğŸ”² è‡ªå‹•æ›´æ–°ï¼ˆelectron-updaterï¼‰
- ğŸ”² è¨—ç›¤åœ–ç¤ºå’Œé¸å–®
- ğŸ”² å…¨åŸŸæ€§å¿«æ·éµ
- ğŸ”² æª”æ¡ˆæ‹–æ‹½
- ğŸ”² åŸç”Ÿå°è©±æ–¹å¡Š
- ğŸ”² ç³»çµ±é€šçŸ¥

## é…ç½®èªªæ˜

### electron/main.cjs
ä¸»ç¨‹å¼é…ç½®å¼•æ•¸ï¼š
- `windowWidth`: 1280ï¼ˆè¦–çª—å¯¬åº¦ï¼‰
- `windowHeight`: 800ï¼ˆè¦–çª—é«˜åº¦ï¼‰
- `minWidth`: 1024ï¼ˆæœ€å°å¯¬åº¦ï¼‰
- `minHeight`: 768ï¼ˆæœ€å°é«˜åº¦ï¼‰
- `backendPort`: 8765ï¼ˆå¾Œç«¯åŸ ï¼‰

### package.json - build é…ç½®
```json
{
  "appId": "com.penguin.magic",
  "productName": "PenguinMagic",
  "directories": {
    "output": "release"
  },
  "files": [
    "dist/**/*",
    "electron/**/*",
    "backend-nodejs/**/*",
    "!backend-nodejs/node_modules/**/*",
    "package.json"
  ],
  "extraResources": [
    {
      "from": "backend-nodejs/node_modules",
      "to": "backend-nodejs/node_modules"
    }
  ]
}
```

## æ•…éšœæ’é™¤

### åŸ è¢«ä½”ç”¨
```bash
# Windows
netstat -ano | findstr :8765
taskkill /F /PID [PID]

# æˆ–åœæ­¢æ‰€æœ‰ Node ç¨‹å¼
taskkill /F /IM node.exe
```

### Electron ç„¡æ³•å•Ÿå‹•
1. æª¢æŸ¥æ˜¯å¦æ­£ç¢ºå®‰è£ electron
   ```bash
   npx electron --version
   ```

2. æ¸…ç†å¿«å–é‡æ–°å®‰è£
   ```bash
   rm -rf node_modules
   npm install
   ```

### æ‰“åŒ…å¤±æ•—
1. ç¢ºä¿å‰ç«¯å·²æ§‹å»º
   ```bash
   npm run build
   ```

2. æª¢æŸ¥ Sharp ä¾è³´
   ```bash
   cd backend-nodejs
   npm rebuild sharp
   ```

3. ä½¿ç”¨æ·˜å¯¶æ˜ è±¡åŠ é€Ÿ
   - å·²é…ç½® .npmrc ä½¿ç”¨åœ‹å…§æ˜ è±¡

### åœ–ç¤ºå•é¡Œ
- ç•¶å‰ä½¿ç”¨ PNG æ ¼å¼åœ–ç¤º
- æª¢è¦– resources/README.md ç­è§£å¦‚ä½•ç”Ÿæˆå…¶ä»–æ ¼å¼

## æ¸¬è©¦æ¸…å–®

- [x] é–‹ç™¼æ¨¡å¼å•Ÿå‹•
- [x] å‰ç«¯æ§‹å»ºæˆåŠŸ
- [x] API è«‹æ±‚æ­£å¸¸
- [x] æª”æ¡ˆä¸Šå‚³/ä¸‹è¼‰
- [x] å½±è±¡è™•ç†åŠŸèƒ½
- [x] é¸å–®åŠŸèƒ½
- [ ] Windows æ‰“åŒ…æ¸¬è©¦
- [ ] å®‰è£åŒ…æ¸¬è©¦
- [ ] ä¾¿æ”œç‰ˆæ¸¬è©¦

## å¾ŒçºŒå·¥ä½œ

1. **åœ–ç¤ºæœ€ä½³åŒ–**ï¼šç”Ÿæˆ .ico å’Œ .icns æ ¼å¼
2. **æ‰“åŒ…æ¸¬è©¦**ï¼šåœ¨ä¸åŒå¹³è‡ºæ¸¬è©¦å®‰è£åŒ…
3. **æ•ˆèƒ½æœ€ä½³åŒ–**ï¼šæ¸›å°æ‰“åŒ…é«”ç©
4. **åŠŸèƒ½å¢å¼·**ï¼šæ–°å¢è¨—ç›¤ã€è‡ªå‹•æ›´æ–°ç­‰
5. **æª”æ¡ˆå®Œå–„**ï¼šä½¿ç”¨è€…ä½¿ç”¨æ‰‹å†Š

## ç›¸é—œè³‡æº

- [Electron æª”æ¡ˆ](https://www.electronjs.org/docs/latest/)
- [Electron Builder æª”æ¡ˆ](https://www.electron.build/)
- [Vite æª”æ¡ˆ](https://vitejs.dev/)

## æŠ€è¡“æ”¯æ´

é‡åˆ°å•é¡Œï¼Ÿ
1. æª¢è¦–æ§åˆ¶æª¯æ—¥èªŒ
2. æª¢æŸ¥ DevTools (F12)
3. æª¢è¦–å¾Œç«¯æ—¥èªŒï¼ˆå¾Œè‡ºæœå‹™è¼¸å‡ºï¼‰
4. åƒè€ƒè¨­è¨ˆæª”æ¡ˆï¼š.qoder/quests/electron-packaging.md
# PenguinMagic Electron æ‰“åŒ…ä½¿ç”¨èªªæ˜

## å·²å®Œæˆçš„å·¥ä½œ

âœ… å®‰è£ Electron ç›¸é—œä¾è³´
âœ… å»ºç«‹ Electron ä¸»ç¨‹å¼ï¼ˆelectron/main.cjsï¼‰
âœ… å»ºç«‹é è¼‰å…¥æŒ‡ä»¤ç¢¼ï¼ˆelectron/preload.cjsï¼‰
âœ… é…ç½®å¾Œç«¯æ”¯æ´ Electron ç’°å¢ƒ
âœ… é…ç½® Vite æ§‹å»º
âœ… æ›´æ–° package.json æŒ‡ä»¤ç¢¼å’Œé…ç½®
âœ… å»ºç«‹æ‡‰ç”¨åœ–ç¤º
âœ… æ¸¬è©¦é–‹ç™¼æ¨¡å¼ - æˆåŠŸåŸ·è¡Œ
âœ… å‰ç«¯æ§‹å»º - æˆåŠŸ

## é–‹ç™¼æ¨¡å¼

å•Ÿå‹•é–‹ç™¼æ¨¡å¼ï¼ˆåŒ…å«ç†±éè¼‰ï¼‰ï¼š

```bash
npm run electron:dev
```

é€™å°‡åŒæ™‚å•Ÿå‹•ï¼š
1. å¾Œç«¯æœå‹™ï¼ˆåŸ  8765ï¼‰
2. Vite é–‹ç™¼ä¼ºæœå™¨ï¼ˆåŸ  5176ï¼‰
3. Electron è¦–çª—

## ç”Ÿç”¢æ§‹å»º

### åƒ…æ§‹å»ºå‰ç«¯
```bash
npm run build
```

### æ‰“åŒ… Windows æ‡‰ç”¨
```bash
npm run package
```

é€™å°‡ï¼š
1. æ§‹å»ºå‰ç«¯ï¼ˆç”Ÿæˆ dist/ï¼‰
2. ä½¿ç”¨ electron-builder æ‰“åŒ…
3. è¼¸å‡ºåˆ° release/ ç›®éŒ„

### æ‰“åŒ…æ‰€æœ‰å¹³è‡º
```bash
npm run package:all
```

æ”¯æ´çš„æ‰“åŒ…æ ¼å¼ï¼š
- **Windows**: NSIS å®‰è£åŒ…ã€ä¾¿æ”œç‰ˆ
- **macOS**: DMGã€ZIP
- **Linux**: AppImageã€DEB

## å°ˆæ¡ˆçµæ§‹

```
PenguinMagic/
â”œâ”€â”€ electron/
â”‚   â”œâ”€â”€ main.cjs          # Electron ä¸»ç¨‹å¼
â”‚   â””â”€â”€ preload.cjs       # é è¼‰å…¥æŒ‡ä»¤ç¢¼
â”œâ”€â”€ backend-nodejs/       # å¾Œç«¯æœå‹™
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ server.js     # Express ä¼ºæœå™¨
â”‚   â”‚   â”œâ”€â”€ config.js     # é…ç½®ï¼ˆæ”¯æ´ Electron ç’°å¢ƒï¼‰
â”‚   â”‚   â””â”€â”€ routes/       # API è·¯ç”±
â”‚   â””â”€â”€ node_modules/     # å¾Œç«¯ä¾è³´ï¼ˆæœƒæ‰“åŒ…é€²æ‡‰ç”¨ï¼‰
â”œâ”€â”€ resources/            # æ‡‰ç”¨è³‡æº
â”‚   â”œâ”€â”€ icon.svg          # SVG åœ–ç¤º
â”‚   â”œâ”€â”€ icon.png          # PNG åœ–ç¤º
â”‚   â””â”€â”€ README.md         # åœ–ç¤ºç”Ÿæˆèªªæ˜
â”œâ”€â”€ dist/                 # å‰ç«¯æ§‹å»ºç”¢ç‰©
â”œâ”€â”€ release/              # æ‰“åŒ…è¼¸å‡ºç›®éŒ„
â””â”€â”€ package.json          # å°ˆæ¡ˆé…ç½®
```

## ç’°å¢ƒè®Šæ•¸

### é–‹ç™¼ç’°å¢ƒ
- `NODE_ENV=development`
- ä½¿ç”¨å°ˆæ¡ˆæ ¹ç›®éŒ„ä½œç‚ºè³‡æ–™ç›®éŒ„

### ç”Ÿç”¢ç’°å¢ƒï¼ˆElectronï¼‰
- `NODE_ENV=production`
- `IS_ELECTRON=true`
- `USER_DATA_PATH`: ä½¿ç”¨è€…è³‡æ–™ç›®éŒ„ï¼ˆç”± Electron æä¾›ï¼‰
- è³‡æ–™å„²å­˜åœ¨ï¼š`%APPDATA%/penguin-magic` (Windows)

## è·¯å¾‘è™•ç†

### é–‹ç™¼æ¨¡å¼
- åŸºç¤ç›®éŒ„ï¼šå°ˆæ¡ˆæ ¹ç›®éŒ„
- å‰ç«¯ï¼šhttp://localhost:5176
- å¾Œç«¯ï¼šhttp://localhost:8765

### ç”Ÿç”¢æ¨¡å¼ï¼ˆElectronï¼‰
- åŸºç¤ç›®éŒ„ï¼šä½¿ç”¨è€…è³‡æ–™ç›®éŒ„
- å‰ç«¯ï¼šå¾ dist/ è¼‰å…¥ï¼ˆç”±å¾Œç«¯æœå‹™ï¼‰
- å¾Œç«¯ï¼šå…§åµŒåœ¨æ‡‰ç”¨ä¸­ï¼Œè‡ªå‹•å•Ÿå‹•

## åŠŸèƒ½ç‰¹æ€§

### å·²å¯¦ç¾
- âœ… è¦–çª—ç®¡ç†ï¼ˆå»ºç«‹ã€é—œé–‰ã€ç”Ÿå‘½é€±æœŸï¼‰
- âœ… å¾Œç«¯æœå‹™è‡ªå‹•å•Ÿå‹•å’Œåœæ­¢
- âœ… åŸç”Ÿé¸å–®æ¬„ï¼ˆæª”æ¡ˆã€ç·¨è¼¯ã€æª¢è¦–ã€å¹«åŠ©ï¼‰
- âœ… é–‹ç™¼è€…å·¥å…·ï¼ˆF12ï¼‰
- âœ… ä¸Šä¸‹æ–‡éš”é›¢å’Œå®‰å…¨é…ç½®
- âœ… è·¨å¹³è‡ºè·¯å¾‘è™•ç†
- âœ… åœ–ç¤ºè³‡æºç®¡ç†

### å¯æ“´å……å¥—ä»¶åŠŸèƒ½
- ğŸ”² è‡ªå‹•æ›´æ–°ï¼ˆelectron-updaterï¼‰
- ğŸ”² è¨—ç›¤åœ–ç¤ºå’Œé¸å–®
- ğŸ”² å…¨åŸŸæ€§å¿«æ·éµ
- ğŸ”² æª”æ¡ˆæ‹–æ‹½
- ğŸ”² åŸç”Ÿå°è©±æ–¹å¡Š
- ğŸ”² ç³»çµ±é€šçŸ¥

## é…ç½®èªªæ˜

### electron/main.cjs
ä¸»ç¨‹å¼é…ç½®å¼•æ•¸ï¼š
- `windowWidth`: 1280ï¼ˆè¦–çª—å¯¬åº¦ï¼‰
- `windowHeight`: 800ï¼ˆè¦–çª—é«˜åº¦ï¼‰
- `minWidth`: 1024ï¼ˆæœ€å°å¯¬åº¦ï¼‰
- `minHeight`: 768ï¼ˆæœ€å°é«˜åº¦ï¼‰
- `backendPort`: 8765ï¼ˆå¾Œç«¯åŸ ï¼‰

### package.json - build é…ç½®
```json
{
  "appId": "com.penguin.magic",
  "productName": "PenguinMagic",
  "directories": {
    "output": "release"
  },
  "files": [
    "dist/**/*",
    "electron/**/*",
    "backend-nodejs/**/*",
    "!backend-nodejs/node_modules/**/*",
    "package.json"
  ],
  "extraResources": [
    {
      "from": "backend-nodejs/node_modules",
      "to": "backend-nodejs/node_modules"
    }
  ]
}
```

## æ•…éšœæ’é™¤

### åŸ è¢«ä½”ç”¨
```bash
# Windows
netstat -ano | findstr :8765
taskkill /F /PID [PID]

# æˆ–åœæ­¢æ‰€æœ‰ Node ç¨‹å¼
taskkill /F /IM node.exe
```

### Electron ç„¡æ³•å•Ÿå‹•
1. æª¢æŸ¥æ˜¯å¦æ­£ç¢ºå®‰è£ electron
   ```bash
   npx electron --version
   ```

2. æ¸…ç†å¿«å–é‡æ–°å®‰è£
   ```bash
   rm -rf node_modules
   npm install
   ```

### æ‰“åŒ…å¤±æ•—
1. ç¢ºä¿å‰ç«¯å·²æ§‹å»º
   ```bash
   npm run build
   ```

2. æª¢æŸ¥ Sharp ä¾è³´
   ```bash
   cd backend-nodejs
   npm rebuild sharp
   ```

3. ä½¿ç”¨æ·˜å¯¶æ˜ è±¡åŠ é€Ÿ
   - å·²é…ç½® .npmrc ä½¿ç”¨åœ‹å…§æ˜ è±¡

### åœ–ç¤ºå•é¡Œ
- ç•¶å‰ä½¿ç”¨ PNG æ ¼å¼åœ–ç¤º
- æª¢è¦– resources/README.md ç­è§£å¦‚ä½•ç”Ÿæˆå…¶ä»–æ ¼å¼

## æ¸¬è©¦æ¸…å–®

- [x] é–‹ç™¼æ¨¡å¼å•Ÿå‹•
- [x] å‰ç«¯æ§‹å»ºæˆåŠŸ
- [x] API è«‹æ±‚æ­£å¸¸
- [x] æª”æ¡ˆä¸Šå‚³/ä¸‹è¼‰
- [x] å½±è±¡è™•ç†åŠŸèƒ½
- [x] é¸å–®åŠŸèƒ½
- [ ] Windows æ‰“åŒ…æ¸¬è©¦
- [ ] å®‰è£åŒ…æ¸¬è©¦
- [ ] ä¾¿æ”œç‰ˆæ¸¬è©¦

## å¾ŒçºŒå·¥ä½œ

1. **åœ–ç¤ºæœ€ä½³åŒ–**ï¼šç”Ÿæˆ .ico å’Œ .icns æ ¼å¼
2. **æ‰“åŒ…æ¸¬è©¦**ï¼šåœ¨ä¸åŒå¹³è‡ºæ¸¬è©¦å®‰è£åŒ…
3. **æ•ˆèƒ½æœ€ä½³åŒ–**ï¼šæ¸›å°æ‰“åŒ…é«”ç©
4. **åŠŸèƒ½å¢å¼·**ï¼šæ–°å¢è¨—ç›¤ã€è‡ªå‹•æ›´æ–°ç­‰
5. **æª”æ¡ˆå®Œå–„**ï¼šä½¿ç”¨è€…ä½¿ç”¨æ‰‹å†Š

## ç›¸é—œè³‡æº

- [Electron æª”æ¡ˆ](https://www.electronjs.org/docs/latest/)
- [Electron Builder æª”æ¡ˆ](https://www.electron.build/)
- [Vite æª”æ¡ˆ](https://vitejs.dev/)

## æŠ€è¡“æ”¯æ´

é‡åˆ°å•é¡Œï¼Ÿ
1. æª¢è¦–æ§åˆ¶æª¯æ—¥èªŒ
2. æª¢æŸ¥ DevTools (F12)
3. æª¢è¦–å¾Œç«¯æ—¥èªŒï¼ˆå¾Œè‡ºæœå‹™è¼¸å‡ºï¼‰
4. åƒè€ƒè¨­è¨ˆæª”æ¡ˆï¼š.qoder/quests/electron-packaging.md
